{"version":3,"sources":["../../../src/hooks/emitters/permissions.js"],"names":["EventEmitter","cachedValue","cachedSubscribe","cachedUnsubscribe","PermissionsEmitter","constructor","sourceId","targetId","value","emit","setParameters","cleanup","name","handleUpdate","undefined"],"mappings":";;AAEA,OAAOA,YAAP,MAAyB,QAAzB;AACA,SAASC,WAAT,EAAsBC,eAAtB,EAAuCC,iBAAvC,QAAgE,aAAhE;AAEA,eAAe,MAAMC,kBAAN,SAAiCJ,YAAjC,CAA8C;AAG3DK,EAAAA,WAAW,CAACC,QAAD,EAAmBC,QAAnB,EAAqC;AAC9C;;AAD8C;;AAAA,0CAyBhCC,KAAD,IAAe;AAC5B,WAAKC,IAAL,CAAU,OAAV,EAAmBD,KAAnB;AACD,KA3B+C;;AAE9C,SAAKE,aAAL,CAAmBJ,QAAnB,EAA6BC,QAA7B;AACD;;AAEDG,EAAAA,aAAa,CAACJ,QAAD,EAAmBC,QAAnB,EAAqC;AAChD,QAAI,CAACD,QAAD,IAAa,CAACC,QAAlB,EAA4B;AAC1B,WAAKI,OAAL;AACA;AACD;;AACD,UAAMC,IAAI,GAAI,KAAIN,QAAS,IAAGC,QAAS,EAAvC;;AACA,QAAI,KAAKK,IAAL,KAAcA,IAAlB,EAAwB;AACtB,WAAKD,OAAL;AACD;;AACDT,IAAAA,eAAe,CAACU,IAAD,EAAO,KAAKC,YAAZ,CAAf;AACA,SAAKD,IAAL,GAAYA,IAAZ;AACD;;AAEQ,MAALJ,KAAK,GAAG;AACV,QAAI,CAAC,KAAKI,IAAV,EAAgB;AACd,aAAOE,SAAP;AACD;;AACD,WAAOb,WAAW,CAAC,KAAKW,IAAN,CAAlB;AACD;;AAMDD,EAAAA,OAAO,GAAG;AACR,SAAKF,IAAL,CAAU,SAAV;;AACA,QAAI,CAAC,KAAKG,IAAV,EAAgB;AACd;AACD;;AACDT,IAAAA,iBAAiB,CAAC,KAAKS,IAAN,EAAY,KAAKC,YAAjB,CAAjB;AACA,WAAO,KAAKD,IAAZ;AACD;;AAvC0D","sourcesContent":["// @flow\n\nimport EventEmitter from 'events';\nimport { cachedValue, cachedSubscribe, cachedUnsubscribe } from '../../index';\n\nexport default class PermissionsEmitter extends EventEmitter {\n  name: string | void;\n\n  constructor(sourceId?:string, targetId?:string) {\n    super();\n    this.setParameters(sourceId, targetId);\n  }\n\n  setParameters(sourceId?:string, targetId?:string) {\n    if (!sourceId || !targetId) {\n      this.cleanup();\n      return;\n    }\n    const name = `p/${sourceId}/${targetId}`;\n    if (this.name !== name) {\n      this.cleanup();\n    }\n    cachedSubscribe(name, this.handleUpdate);\n    this.name = name;\n  }\n\n  get value() {\n    if (!this.name) {\n      return undefined;\n    }\n    return cachedValue(this.name);\n  }\n\n  handleUpdate = (value:any) => {\n    this.emit('value', value);\n  }\n\n  cleanup() {\n    this.emit('cleanup');\n    if (!this.name) {\n      return;\n    }\n    cachedUnsubscribe(this.name, this.handleUpdate);\n    delete this.name;\n  }\n}\n"],"file":"permissions.js"}