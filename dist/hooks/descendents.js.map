{"version":3,"sources":["../../src/hooks/descendents.js"],"names":["pick","isEmpty","queryString","useState","useEffect","useRef","List","cachedValue","cachedSubscribe","cachedUnsubscribe","parameterNames","parse","v","isList","toJS","undefined","getName","id","parameters","options","type","split","stringify","value","setValue","initialCallbackRef","skipInitialCallback","current","name","handleValue","JSON"],"mappings":"AAEA,SAASA,IAAT,EAAeC,OAAf,QAA8B,QAA9B;AACA,OAAOC,WAAP,MAAwB,cAAxB;AACA,SAASC,QAAT,EAAmBC,SAAnB,EAA8BC,MAA9B,QAA4C,OAA5C;AACA,SAASC,IAAT,QAAqB,WAArB;AACA,SAASC,WAAT,EAAsBC,eAAtB,EAAuCC,iBAAvC,QAAgE,UAAhE;AAEA,MAAMC,cAAc,GAAG,CACrB,OADqB,EAErB,MAFqB,EAGrB,OAHqB,EAIrB,OAJqB,EAKrB,QALqB,EAMrB,QANqB,EAOrB,cAPqB,EAQrB,UARqB,EASrB,WATqB,EAUrB,MAVqB,EAWrB,aAXqB,EAYrB,OAZqB,EAarB,iBAbqB,CAAvB;;AAgBA,MAAMC,KAAK,GAAIC,CAAD,IAAW;AACvB,MAAIN,IAAI,CAACO,MAAL,CAAYD,CAAZ,CAAJ,EAAoB;AAClB,WAAOA,CAAC,CAACE,IAAF,EAAP;AACD;;AACD,SAAOC,SAAP;AACD,CALD;;AAOA,MAAMC,OAAO,GAAG,CAACC,EAAD,EAAYC,UAAkB,GAAG,EAAjC,KAAwC;AACtD,QAAMC,OAAO,GAAGnB,IAAI,CAACkB,UAAD,EAAaR,cAAb,CAApB;;AACA,MAAIS,OAAO,CAACC,IAAR,IAAgB,OAAOD,OAAO,CAACC,IAAf,KAAwB,QAA5C,EAAsD;AACpDD,IAAAA,OAAO,CAACC,IAAR,GAAeD,OAAO,CAACC,IAAR,CAAaC,KAAb,CAAmB,GAAnB,CAAf;AACD;;AACD,SAAOpB,OAAO,CAACkB,OAAD,CAAP,GAAoB,KAAIF,EAAG,cAA3B,GAA4C,KAAIA,EAAG,gBAAef,WAAW,CAACoB,SAAZ,CAAsBH,OAAtB,CAA+B,EAAxG;AACD,CAND;;AAQA,gBAAe,CAACF,EAAD,EAAcC,UAAd,KAAqC;AAClD,QAAM,CAACK,KAAD,EAAQC,QAAR,IAAoBrB,QAAQ,CAAC,OAAOc,EAAP,KAAc,QAAd,GAAyBN,KAAK,CAACJ,WAAW,CAACS,OAAO,CAACC,EAAD,EAAKC,UAAL,CAAR,CAAZ,CAA9B,GAAuEH,SAAxE,CAAlC;AACA,QAAMU,kBAAkB,GAAGpB,MAAM,CAAC,OAAOkB,KAAP,KAAiB,WAAjB,IAAgC,OAAON,EAAP,KAAc,QAA/C,CAAjC;AAEAb,EAAAA,SAAS,CAAC,MAAM;AACd,UAAMsB,mBAAmB,GAAGD,kBAAkB,CAACE,OAA/C;AACAF,IAAAA,kBAAkB,CAACE,OAAnB,GAA6B,KAA7B;;AACA,QAAI,OAAOV,EAAP,KAAc,QAAlB,EAA4B;AAC1B,UAAI,CAACS,mBAAL,EAA0B;AACxBF,QAAAA,QAAQ,CAACT,SAAD,CAAR;AACD;;AACD;AACD;;AACD,UAAMa,IAAI,GAAGZ,OAAO,CAACC,EAAD,EAAKC,UAAL,CAApB;;AACA,UAAMW,WAAW,GAAIjB,CAAD,IAAW;AAC7BY,MAAAA,QAAQ,CAACb,KAAK,CAACC,CAAD,CAAN,CAAR;AACD,KAFD;;AAGAJ,IAAAA,eAAe,CAACoB,IAAD,EAAOC,WAAP,EAAoBd,SAApB,EAA+BW,mBAA/B,CAAf;AACA,WAAO,MAAM;AAAE;AACbjB,MAAAA,iBAAiB,CAACmB,IAAD,EAAOC,WAAP,CAAjB;AACD,KAFD;AAGD,GAjBQ,EAiBN,CAACZ,EAAD,EAAKa,IAAI,CAACR,SAAL,CAAeJ,UAAf,CAAL,CAjBM,CAAT;AAmBA,SAAOK,KAAP;AACD,CAxBD","sourcesContent":["// @flow\n\nimport { pick, isEmpty } from 'lodash';\nimport queryString from 'query-string';\nimport { useState, useEffect, useRef } from 'react';\nimport { List } from 'immutable';\nimport { cachedValue, cachedSubscribe, cachedUnsubscribe } from '../index';\n\nconst parameterNames = [\n  'depth',\n  'sort',\n  'order',\n  'limit',\n  'offset',\n  'filter',\n  'edgeContains',\n  'hasChild',\n  'hasParent',\n  'type',\n  'typesInTree',\n  'query',\n  'includeInactive',\n];\n\nconst parse = (v:any) => {\n  if (List.isList(v)) {\n    return v.toJS();\n  }\n  return undefined;\n};\n\nconst getName = (id:string, parameters?:Object = {}) => {\n  const options = pick(parameters, parameterNames);\n  if (options.type && typeof options.type === 'string') {\n    options.type = options.type.split(',');\n  }\n  return isEmpty(options) ? `n/${id}/descendents` : `n/${id}/descendents?${queryString.stringify(options)}`;\n};\n\nexport default (id?: string, parameters?:Object) => {\n  const [value, setValue] = useState(typeof id === 'string' ? parse(cachedValue(getName(id, parameters))) : undefined);\n  const initialCallbackRef = useRef(typeof value !== 'undefined' || typeof id !== 'string');\n\n  useEffect(() => {\n    const skipInitialCallback = initialCallbackRef.current;\n    initialCallbackRef.current = false;\n    if (typeof id !== 'string') {\n      if (!skipInitialCallback) {\n        setValue(undefined);\n      }\n      return;\n    }\n    const name = getName(id, parameters);\n    const handleValue = (v:any) => {\n      setValue(parse(v));\n    };\n    cachedSubscribe(name, handleValue, undefined, skipInitialCallback);\n    return () => { // eslint-disable-line consistent-return\n      cachedUnsubscribe(name, handleValue);\n    };\n  }, [id, JSON.stringify(parameters)]);\n\n  return value;\n};\n"],"file":"descendents.js"}