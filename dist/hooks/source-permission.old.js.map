{"version":3,"sources":["../../src/hooks/source-permission.old.js"],"names":["useState","useEffect","useRef","isEmpty","pick","queryString","List","cachedValue","cachedSubscribe","cachedUnsubscribe","parameterNames","parse","v","isList","toJS","undefined","getName","ids","permission","parameters","parts","push","Array","isArray","id","options","join","stringify","value","setValue","length","initialCallbackRef","skipInitialCallback","current","name","handleValue","JSON"],"mappings":"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","sourcesContent":["// @flow\n\nimport { useState, useEffect, useRef } from 'react';\nimport isEmpty from 'lodash/isEmpty';\nimport pick from 'lodash/pick';\nimport queryString from 'query-string';\nimport { List } from 'immutable';\nimport { cachedValue, cachedSubscribe, cachedUnsubscribe } from '../index';\n\nconst parameterNames = [\n  'sort',\n  'order',\n  'limit',\n  'offset',\n  'filter',\n  'type',\n  'query',\n  'readPermission',\n  'hasChild',\n  'hasParent',\n  'onlineInTeam',\n  'parentEdgeContains',\n  'typesInTree',\n];\n\nconst parse = (v:any) => {\n  if (List.isList(v)) {\n    return v.toJS();\n  }\n  return undefined;\n};\n\nconst getName = (ids:string | Array<string>, permission: string, parameters?: Object = {}) => {\n  const parts = ['p'];\n  if (typeof ids === 'string') {\n    parts.push(ids);\n  } else if (Array.isArray(ids)) {\n    for (const id of ids) {\n      parts.push(id);\n    }\n  }\n  parts.push(permission);\n  const options = pick(parameters, parameterNames);\n  return isEmpty(options) ? parts.join('/') : `${parts.join('/')}?${queryString.stringify(options)}`;\n};\n\nexport default (ids?:string | Array<string>, permission?: string, parameters?: Object) => {\n  const [value, setValue] = useState(typeof permission === 'string' && (typeof ids === 'string' || (Array.isArray(ids) && ids.length > 0)) ? parse(cachedValue(getName(ids, permission, parameters))) : undefined);\n  const initialCallbackRef = useRef(typeof value !== 'undefined' || !(typeof permission === 'string' && (typeof ids === 'string' || (Array.isArray(ids) && ids.length > 0))));\n\n  useEffect(() => {\n    const skipInitialCallback = initialCallbackRef.current;\n    initialCallbackRef.current = false;\n    if (!(typeof permission === 'string' && (typeof ids === 'string' || (Array.isArray(ids) && ids.length > 0)))) {\n      if (!skipInitialCallback) {\n        setValue(undefined);\n      }\n      return;\n    }\n\n    const name = getName(ids, permission, parameters);\n\n    const handleValue = (v:any) => {\n      setValue(parse(v));\n    };\n\n    cachedSubscribe(name, handleValue, undefined, skipInitialCallback);\n    return () => { // eslint-disable-line consistent-return\n      cachedUnsubscribe(name, handleValue);\n    };\n  }, [JSON.stringify(ids), permission, JSON.stringify(parameters)]);\n\n  return value;\n};\n"],"file":"source-permission.old.js"}